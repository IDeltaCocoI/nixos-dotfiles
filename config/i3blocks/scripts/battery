#!/usr/bin/env bash
# i3blocks - battery
# Affiche l'état de la batterie en % avec icônes Nerd Font
# Ne renvoie rien si pas de batterie

# Détecter le chemin de la batterie
BAT_PATH=$(ls /sys/class/power_supply/ | grep -E '^BAT')
[ -z "$BAT_PATH" ] && exit 0

BAT_DIR="/sys/class/power_supply/$BAT_PATH"

# Lire le niveau de charge
CAPACITY="N/A"
[ -f "$BAT_DIR/capacity" ] && CAPACITY=$(<"$BAT_DIR/capacity")

# Lire l'état (Charging / Discharging / Full)
STATUS="Unknown"
[ -f "$BAT_DIR/status" ] && STATUS=$(<"$BAT_DIR/status")

# Choisir l'icône selon l'état et le niveau
if [ "$STATUS" = "Charging" ]; then
    ICON=""  # Éclair pour charge
elif [ "$STATUS" = "Full" ]; then
    ICON=" "  # Batterie pleine
else
    # Discharging → icône selon % restant
    if [ "$CAPACITY" -ge 75 ]; then
        ICON=" "
    elif [ "$CAPACITY" -ge 50 ]; then
        ICON=" "
    elif [ "$CAPACITY" -ge 25 ]; then
        ICON=" "
    elif [ "$CAPACITY" -ge 10 ]; then
        ICON=" "
    else
        ICON=" "
    fi
fi

# Affichage final
echo " $ICON  ${CAPACITY}% "

